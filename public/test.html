<html>
<head>
    <style>
        .user {
            cursor: pointer;
            border: 1px chocolate;
        }
    </style>
</head>
<body>
<div id="root">
    <ul id="av">
    </ul>
    <div id="messages"></div>
    <textarea id="mess"></textarea>
    <input type="hidden" id="send_to">
    <button onclick="send()">Wy≈õlij</button>
</div>
<script>
    var host = 'ws://0.0.0.0:12345';
    var socket = new WebSocket(host);
    console.log(socket.readyState);
    socket.onopen = function (msg) {
        console.log("Welcome - status " + this.readyState);
    };
    socket.onmessage = function (e) {
        var data = JSON.parse(e.data);
        if (data.type == 'text') {
            document.getElementById('messages').innerHTML += 'from:' + data.from + ':' + data.value + '</br>';
        }

        if (data.type == 'available_list') {
            var value = data.value;
            value.forEach(function (from) {
                var li = document.createElement('li');
                li.setAttribute('id', from);
                li.setAttribute('class', 'user');
                li.addEventListener('click', selectUser);
                li.innerText = from;
                document.getElementById('av').append(li);
            });
        }

        if (data.type == 'available') {
            var value = data.value;
            var from = data.from;
            if (value) {
                var li = document.createElement('li');
                li.setAttribute('id', from);
                li.setAttribute('class', 'user');
                li.innerText = from;
                li.addEventListener('click', selectUser);
                document.getElementById('av').append(li);
            } else {
                document.getElementById(from).remove();
            }
        }
    };
    socket.onclose = function (msg) {
        console.log("Disconnected - status " + this.readyState);
    };

    function send() {
        let value = document.getElementById('mess').value;
        let send_to = document.getElementById('send_to').value;
        if (value && send_to) {
            socket.send(JSON.stringify({'value': value, type: 'text', to: [send_to]}));
            document.getElementById('mess').value = '';
        }
    }

    function selectUser(e) {
        console.log(e);
        var id = e.target.id;
        document.getElementById('send_to').value = id;
    }
</script>
</body>
</html>